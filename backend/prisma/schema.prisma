generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String   @id @default(uuid()) @db.Uuid
  email           String   @unique
  username        String   @unique
  password_hash   String
  fullname        String
  bio             String?
  profile_picture String?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  sessions Session[]
  tweets   Tweet[]
  likes    TweetLike[]
  comments TweetComment[]

  followers UserFollows[] @relation("followers")
  following UserFollows[] @relation("following")
}

model Session {
  id            String   @id @default(uuid()) @db.Uuid
  user_id       String   @db.Uuid
  refresh_token String   @unique
  expires_at    DateTime
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Tweet {
  id         String    @id @default(uuid()) @db.Uuid
  user_id    String    @db.Uuid
  content    String
  media_url  String?
  is_deleted Boolean   @default(false)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  likes    TweetLike[]
  comments TweetComment[]
}

model TweetLike {
  id         String   @id @default(uuid()) @db.Uuid
  user_id    String   @db.Uuid
  tweet_id   String   @db.Uuid
  created_at DateTime @default(now())

  user  User  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  tweet Tweet @relation(fields: [tweet_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([user_id, tweet_id])
}

model TweetComment {
  id         String   @id @default(uuid()) @db.Uuid
  user_id    String   @db.Uuid
  tweet_id   String   @db.Uuid
  content    String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user  User  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  tweet Tweet @relation(fields: [tweet_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model UserFollows {
  follower_id  String   @db.Uuid
  following_id String   @db.Uuid
  created_at   DateTime @default(now())

  follower  User @relation("following", fields: [follower_id], references: [id], onDelete: Cascade)
  following User @relation("followers", fields: [following_id], references: [id], onDelete: Cascade)

  @@id([follower_id, following_id])
}
